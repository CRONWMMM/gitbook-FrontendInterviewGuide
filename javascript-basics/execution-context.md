---
description: >-
  å½“ JS
  å¼•æ“å¤„ç†ä¸€æ®µè„šæœ¬å†…å®¹çš„æ—¶å€™ï¼Œå®ƒæ˜¯ä»¥æ€æ ·çš„é¡ºåºè§£æå’Œæ‰§è¡Œçš„ï¼Ÿè„šæœ¬ä¸­çš„é‚£äº›å˜é‡æ˜¯ä½•æ—¶è¢«å®šä¹‰çš„ï¼Ÿå®ƒä»¬ä¹‹é—´é”™ç»¼å¤æ‚çš„è®¿é—®å…³ç³»åˆæ˜¯æ€æ ·åˆ›å»ºå’Œé“¾æ¥çš„ï¼Ÿè¦è§£é‡Šè¿™äº›é—®é¢˜ï¼Œå°±å¿…é¡»äº†è§£
  JS æ‰§è¡Œä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚
---

# æ‰§è¡Œä¸Šä¸‹æ–‡

### ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡

å½“ `JS` å¼•æ“è§£æåˆ°å¯æ‰§è¡Œä»£ç ç‰‡æ®µï¼ˆé€šå¸¸æ˜¯å‡½æ•°è°ƒç”¨é˜¶æ®µï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆåšä¸€äº›æ‰§è¡Œå‰çš„å‡†å¤‡å·¥ä½œï¼Œè¿™ä¸ª **â€œå‡†å¤‡å·¥ä½œâ€**ï¼Œå°±å«åš **"æ‰§è¡Œä¸Šä¸‹æ–‡\(execution context ç®€ç§° `EC`\)"** æˆ–è€…ä¹Ÿå¯ä»¥å«åš**æ‰§è¡Œç¯å¢ƒ**ã€‚

{% hint style="info" %}
**æ‰§è¡Œä¸Šä¸‹æ–‡** ä¸ºæˆ‘ä»¬çš„å¯æ‰§è¡Œä»£ç å—æä¾›äº†æ‰§è¡Œå‰çš„å¿…è¦å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚å˜é‡å¯¹è±¡çš„å®šä¹‰ã€ä½œç”¨åŸŸé“¾çš„æ‰©å±•ã€æä¾›è°ƒç”¨è€…çš„å¯¹è±¡å¼•ç”¨ç­‰ä¿¡æ¯ã€‚
{% endhint %}

### æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹

`javascript` ä¸­æœ‰ä¸‰ç§æ‰§è¡Œä¸Šä¸‹æ–‡ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š

* **å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡**â€”â€”è¿™æ˜¯é»˜è®¤æˆ–è€…è¯´æ˜¯æœ€åŸºç¡€çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªç¨‹åºä¸­åªä¼šå­˜åœ¨ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ï¼Œ

  å®ƒåœ¨æ•´ä¸ª `javascript` è„šæœ¬çš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¼šå­˜åœ¨äºæ‰§è¡Œå †æ ˆçš„æœ€åº•éƒ¨ä¸ä¼šè¢«æ ˆå¼¹å‡ºé”€æ¯ã€‚å…¨å±€ä¸Šä¸‹æ–‡ä¼šç”Ÿæˆä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆä»¥æµè§ˆå™¨ç¯å¢ƒä¸ºä¾‹ï¼Œè¿™ä¸ªå…¨å±€å¯¹è±¡æ˜¯ `window`ï¼‰ï¼Œå¹¶ä¸”å°† `this` å€¼ç»‘å®šåˆ°è¿™ä¸ªå…¨å±€å¯¹è±¡ä¸Šã€‚

* **å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**â€”â€”æ¯å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä¸ç®¡è¿™ä¸ªå‡½æ•°æ˜¯ä¸æ˜¯è¢«é‡å¤è°ƒç”¨çš„ï¼‰
* **Eval å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**â€”â€” æ‰§è¡Œåœ¨ `eval` å‡½æ•°å†…éƒ¨çš„ä»£ç ä¹Ÿä¼šæœ‰å®ƒå±äºè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä½†ç”±äºå¹¶ä¸ç»å¸¸ä½¿ç”¨ `eval`ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¸åšåˆ†æã€‚

### æ‰§è¡Œä¸Šä¸‹æ–‡çš„å†…å®¹

æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ª `object` ï¼Œä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡é‡ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

1. å˜é‡å¯¹è±¡
2. æ´»åŠ¨å¯¹è±¡
3. ä½œç”¨åŸŸé“¾
4. è°ƒç”¨è€…ä¿¡æ¯

#### å˜é‡å¯¹è±¡ï¼ˆ`variable object` ç®€ç§° `VO`ï¼‰

> åŸæ–‡ï¼šEvery execution context has associated with it a variable object. Variables and functions declared in the source text are added as properties of the variable object. For function code, parameters are added as properties of the variable object.

æ¯ä¸ªæ‰§è¡Œç¯å¢ƒæ–‡éƒ½æœ‰ä¸€ä¸ªè¡¨ç¤ºå˜é‡çš„å¯¹è±¡â€”â€”**å˜é‡å¯¹è±¡**ï¼Œå…¨å±€æ‰§è¡Œç¯å¢ƒçš„å˜é‡å¯¹è±¡å§‹ç»ˆå­˜åœ¨ï¼Œè€Œå‡½æ•°è¿™æ ·å±€éƒ¨ç¯å¢ƒçš„å˜é‡ï¼Œåªä¼šåœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å­˜åœ¨ï¼Œåœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ä¸”åœ¨å…·ä½“çš„å‡½æ•°ä»£ç è¿è¡Œä¹‹å‰ï¼ŒJS å¼•æ“ä¼šç”¨å½“å‰å‡½æ•°çš„**å‚æ•°åˆ—è¡¨**ï¼ˆ`arguments`ï¼‰åˆå§‹åŒ–ä¸€ä¸ª â€œå˜é‡å¯¹è±¡â€ å¹¶å°†å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸ä¹‹å…³è” ï¼Œå‡½æ•°ä»£ç å—ä¸­å£°æ˜çš„ **å˜é‡** å’Œ **å‡½æ•°** å°†ä½œä¸ºå±æ€§æ·»åŠ åˆ°è¿™ä¸ªå˜é‡å¯¹è±¡ä¸Šã€‚

![&#x53D8;&#x91CF;&#x5BF9;&#x8C61;&#x7684;&#x521B;&#x5EFA;&#x7EC6;&#x8282;](../.gitbook/assets/outfunvo.jpg)

{% hint style="warning" %}
æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåªæœ‰**å‡½æ•°å£°æ˜**ï¼ˆ`function declaration`ï¼‰ä¼šè¢«åŠ å…¥åˆ°å˜é‡å¯¹è±¡ä¸­ï¼Œè€Œ**å‡½æ•°è¡¨è¾¾å¼**ï¼ˆ`function expression`ï¼‰ä¼šè¢«å¿½ç•¥ã€‚
{% endhint %}

```javascript
// è¿™ç§å«åšå‡½æ•°å£°æ˜ï¼Œä¼šè¢«åŠ å…¥å˜é‡å¯¹è±¡
function a () {}

// b æ˜¯å˜é‡å£°æ˜ï¼Œä¹Ÿä¼šè¢«åŠ å…¥å˜é‡å¯¹è±¡ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼ _b ä¸ä¼šè¢«åŠ å…¥å˜é‡å¯¹è±¡
var b = function _b () {}
```

{% hint style="info" %}
å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡è¿˜ç•¥æœ‰ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´çš„å·®åˆ«ç®€å•æ¥è¯´ï¼š

1. **å…¨å±€ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡å°±æ˜¯å…¨å±€å¯¹è±¡**ï¼Œä»¥æµè§ˆå™¨ç¯å¢ƒæ¥è¯´ï¼Œå°±æ˜¯ `window` å¯¹è±¡ã€‚
2. **å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡å†…éƒ¨å®šä¹‰çš„å±æ€§ï¼Œæ˜¯ä¸èƒ½è¢«ç›´æ¥è®¿é—®çš„**ï¼Œåªæœ‰å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå˜é‡å¯¹è±¡ï¼ˆVOï¼‰è¢«æ¿€æ´»ä¸ºæ´»åŠ¨å¯¹è±¡ï¼ˆAOï¼‰æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½è®¿é—®åˆ°å…¶ä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚
{% endhint %}

#### æ´»åŠ¨å¯¹è±¡ï¼ˆ`activation object` ç®€ç§° `AO`ï¼‰

> åŸæ–‡ï¼šWhen control enters an execution context for function code, an object called the activation object is created and associated with the execution context. The activation object is initialised with a property with name arguments and attributes { DontDelete }. The initial value of this property is the arguments object described below. The activation object is then used as the variable object for the purposes of variable instantiation.

å‡½æ•°è¿›å…¥æ‰§è¡Œé˜¶æ®µæ—¶ï¼ŒåŸæœ¬ä¸èƒ½è®¿é—®çš„å˜é‡å¯¹è±¡è¢«æ¿€æ´»æˆä¸ºä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œè‡ªæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°å…¶ä¸­çš„å„ç§å±æ€§ã€‚

{% hint style="info" %}
å…¶å®å˜é‡å¯¹è±¡å’Œæ´»åŠ¨å¯¹è±¡æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œåªä¸è¿‡å¤„äºä¸åŒçš„çŠ¶æ€å’Œé˜¶æ®µè€Œå·²ã€‚
{% endhint %}

#### ä½œç”¨åŸŸé“¾ï¼ˆ`scope chain`ï¼‰

{% hint style="info" %}
**ä½œç”¨åŸŸ** è§„å®šäº†å¦‚ä½•æŸ¥æ‰¾å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå½“å‰æ‰§è¡Œä»£ç å¯¹å˜é‡çš„è®¿é—®æƒé™ã€‚å½“æŸ¥æ‰¾å˜é‡çš„æ—¶å€™ï¼Œä¼šå…ˆä»å½“å‰ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šä»çˆ¶çº§ï¼ˆè¯æ³•å±‚é¢ä¸Šçš„çˆ¶çº§ï¼‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…¨å±€å¯¹è±¡ã€‚è¿™æ ·ç”±å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ„æˆçš„é“¾è¡¨å°±å«åš **ä½œç”¨åŸŸé“¾**ã€‚
{% endhint %}

å‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°åˆ›å»ºæ—¶å°±å·²ç»ç¡®å®šäº†ã€‚å½“å‡½æ•°åˆ›å»ºæ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªåä¸º `[[scope]]` çš„å†…éƒ¨å±æ€§ä¿å­˜æ‰€æœ‰çˆ¶å˜é‡å¯¹è±¡åˆ°å…¶ä¸­ã€‚å½“å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œç„¶åé€šè¿‡å¤åˆ¶å‡½æ•°çš„ `[[scope]]`  å±æ€§ä¸­çš„å¯¹è±¡æ„å»ºèµ·æ‰§è¡Œç¯å¢ƒçš„ä½œç”¨åŸŸé“¾ï¼Œç„¶åï¼Œå˜é‡å¯¹è±¡ `VO` è¢«æ¿€æ´»ç”Ÿæˆ `AO` å¹¶æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾çš„å‰ç«¯ï¼Œå®Œæ•´ä½œç”¨åŸŸé“¾åˆ›å»ºå®Œæˆï¼š

```javascript
Scope = [AO].concat([[Scope]]);
```

#### å½“å‰å¯æ‰§è¡Œä»£ç å—çš„è°ƒç”¨è€…ï¼ˆthisï¼‰

å¦‚æœå½“å‰å‡½æ•°è¢«ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨æˆ–ä½¿ç”¨ `bind` `call` `apply` ç­‰ `API` è¿›è¡Œå§”æ‰˜è°ƒç”¨ï¼Œåˆ™å°†å½“å‰ä»£ç å—çš„è°ƒç”¨è€…ä¿¡æ¯ï¼ˆ`this value`ï¼‰å­˜å…¥å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¦åˆ™é»˜è®¤ä¸ºå…¨å±€å¯¹è±¡è°ƒç”¨ã€‚

{% hint style="info" %}
å…³äº `this` çš„åˆ›å»ºç»†èŠ‚ï¼Œæœ‰ç‚¹çƒ¦ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è¿›å…¥ [ä¼ é€é—¨](https://github.com/mqyqingfeng/Blog/issues/7) å­¦ä¹ ã€‚
{% endhint %}

#### æ‰§è¡Œä¸Šä¸‹æ–‡æ•°æ®ç»“æ„æ¨¡æ‹Ÿ

å¦‚æœå°†ä¸Šè¿°ä¸€ä¸ªå®Œæ•´çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä½¿ç”¨ä»£ç å½¢å¼è¡¨ç°å‡ºæ¥çš„è¯ï¼Œåº”è¯¥ç±»ä¼¼äºä¸‹é¢è¿™ç§ï¼š

```javascript
executionContextï¼š{
    [variable object | activation object]ï¼š{
        arguments,
        variables: [...],
        funcions: [...]
    },
    scope chain: variable object + all parents scopes
    thisValue: context object
}
```

### æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ

æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼š

* åˆ›å»ºé˜¶æ®µ
* æ‰§è¡Œé˜¶æ®µ
* é”€æ¯é˜¶æ®µ

#### åˆ›å»ºé˜¶æ®µ

å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»ºé˜¶æ®µï¼Œå‘ç”Ÿåœ¨å‡½æ•°è°ƒç”¨æ—¶ä¸”åœ¨æ‰§è¡Œå‡½æ•°ä½“å†…çš„å…·ä½“ä»£ç ä¹‹å‰ï¼Œåœ¨åˆ›å»ºé˜¶æ®µï¼ŒJS å¼•æ“ä¼šåšå¦‚ä¸‹æ“ä½œï¼š

* ç”¨å½“å‰å‡½æ•°çš„**å‚æ•°åˆ—è¡¨**ï¼ˆ`arguments`ï¼‰åˆå§‹åŒ–ä¸€ä¸ª â€œå˜é‡å¯¹è±¡â€ å¹¶å°†å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸ä¹‹å…³è” ï¼Œå‡½æ•°ä»£ç å—ä¸­å£°æ˜çš„ **å˜é‡** å’Œ **å‡½æ•°** å°†ä½œä¸ºå±æ€§æ·»åŠ åˆ°è¿™ä¸ªå˜é‡å¯¹è±¡ä¸Šã€‚**åœ¨è¿™ä¸€é˜¶æ®µï¼Œä¼šè¿›è¡Œå˜é‡å’Œå‡½æ•°çš„åˆå§‹åŒ–å£°æ˜ï¼Œå˜é‡ç»Ÿä¸€å®šä¹‰ä¸º `undefined` éœ€è¦ç­‰åˆ°èµ‹å€¼æ—¶æ‰ä¼šæœ‰ç¡®å€¼ï¼Œè€Œå‡½æ•°åˆ™ä¼šç›´æ¥å®šä¹‰**ã€‚



  > æœ‰æ²¡æœ‰å‘ç°è¿™æ®µåŠ ç²—çš„æè¿°éå¸¸ç†Ÿæ‚‰ï¼Ÿæ²¡é”™ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯  **å˜é‡å£°æ˜æå‡**ï¼ˆå˜é‡å’Œå‡½æ•°å£°æ˜éƒ½ä¼šæå‡ï¼Œä½†æ˜¯å‡½æ•°æå‡æ›´é å‰ï¼‰ã€‚

* æ„å»ºä½œç”¨åŸŸé“¾ï¼ˆå‰é¢å·²ç»è¯´è¿‡æ„å»ºç»†èŠ‚ï¼‰
* ç¡®å®š `this` çš„å€¼

#### æ‰§è¡Œé˜¶æ®µ

æ‰§è¡Œé˜¶æ®µä¸­ï¼ŒJS ä»£ç å¼€å§‹é€æ¡æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼ŒJS  å¼•æ“å¼€å§‹å¯¹å®šä¹‰çš„å˜é‡èµ‹å€¼ã€å¼€å§‹é¡ºç€ä½œç”¨åŸŸé“¾è®¿é—®å˜é‡ã€å¦‚æœå†…éƒ¨æœ‰å‡½æ•°è°ƒç”¨å°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥æ‰§è¡Œæ ˆå¹¶æŠŠæ§åˆ¶æƒäº¤å‡ºâ€¦â€¦

#### é”€æ¯é˜¶æ®µ

ä¸€èˆ¬æ¥è®²å½“å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå±€éƒ¨ç¯å¢ƒï¼‰ä¼šè¢«å¼¹å‡ºæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå¹¶ä¸”é”€æ¯ï¼Œæ§åˆ¶æƒè¢«é‡æ–°äº¤ç»™æ‰§è¡Œæ ˆä¸Šä¸€å±‚çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

{% hint style="warning" %}
æ³¨æ„è¿™åªæ˜¯ä¸€èˆ¬æƒ…å†µï¼Œé—­åŒ…çš„æƒ…å†µåˆæœ‰æ‰€ä¸åŒã€‚
{% endhint %}

é—­åŒ…çš„å®šä¹‰ï¼š**æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ã€‚**ç®€å•è¯´æ¥ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°è¢«ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶åœ¨å¤–éƒ¨è¢«å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±è¢«ç§°ä¸ºé—­åŒ…ã€‚

```javascript
function funcFactory () {
    var a = 1;
    return function () {
        alert(a);
    }
}

// é—­åŒ…
var sayA = funcFactory();
sayA();
```

å½“é—­åŒ…çš„çˆ¶åŒ…è£¹å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œçˆ¶å‡½æ•°æœ¬èº«æ‰§è¡Œç¯å¢ƒçš„ä½œç”¨åŸŸé“¾ä¼šè¢«é”€æ¯ï¼Œä½†æ˜¯ç”±äºé—­åŒ…çš„ä½œç”¨åŸŸé“¾ä»ç„¶åœ¨å¼•ç”¨çˆ¶å‡½æ•°çš„å˜é‡å¯¹è±¡ï¼Œå¯¼è‡´äº†çˆ¶å‡½æ•°çš„å˜é‡å¯¹è±¡ä¼šä¸€ç›´é©»å­˜äºå†…å­˜ï¼Œæ— æ³•é”€æ¯ï¼Œé™¤éé—­åŒ…çš„å¼•ç”¨è¢«é”€æ¯ï¼Œé—­åŒ…ä¸å†å¼•ç”¨çˆ¶å‡½æ•°çš„å˜é‡å¯¹è±¡ï¼Œè¿™å—å†…å­˜æ‰èƒ½è¢«é‡Šæ”¾æ‰ã€‚è¿‡åº¦ä½¿ç”¨é—­åŒ…ä¼šé€ æˆ **å†…å­˜æ³„éœ²** çš„é—®é¢˜ï¼Œè¿™å—ç­‰åˆ°é—­åŒ…ç« èŠ‚å†åšè¯¦ç»†åˆ†æã€‚

### æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ

å½“ä¸€æ®µè„šæœ¬è¿è¡Œèµ·æ¥çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¾ˆå¤šå‡½æ•°å¹¶äº§ç”Ÿå¾ˆå¤šå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™äº›æ‰§è¡Œä¸Šä¸‹æ–‡è¯¥æ€ä¹ˆç®¡ç†å‘¢ï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ`javascript` å¼•æ“å°±åˆ›å»ºäº† â€œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆâ€ ï¼ˆ`Execution context stack` ç®€ç§° `ECS`ï¼‰æ¥ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

é¡¾åæ€ä¹‰ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆæ˜¯æ ˆç»“æ„çš„ï¼Œå› æ­¤éµå¾ª `LIFO`ï¼ˆåè¿›å…ˆå‡ºï¼‰çš„ç‰¹æ€§ï¼Œä»£ç æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œéƒ½ä¼šäº¤ç»™æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆè¿›è¡Œç®¡ç†ã€‚

å½“ JS å¼•æ“å¼€å§‹è§£æè„šæœ¬ä»£ç æ—¶ï¼Œä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ª**å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼Œå‹å…¥æ ˆåº•ï¼ˆè¿™ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä»åˆ›å»ºä¸€ç›´åˆ°ç¨‹åºé”€æ¯ï¼Œéƒ½ä¼šå­˜åœ¨äºæ ˆçš„åº•éƒ¨ï¼‰ã€‚

æ¯å½“å¼•æ“å‘ç°ä¸€å¤„å‡½æ•°è°ƒç”¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„**å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**å‹å…¥æ ˆå†…ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤ç»™è¯¥ä¸Šä¸‹æ–‡ï¼Œå¾…å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå³å°†è¯¥æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆå†…å¼¹å‡ºé”€æ¯ï¼Œå°†æ§åˆ¶æƒé‡æ–°ç»™åˆ°æ ˆå†…ä¸Šä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

![](../.gitbook/assets/executioncontextstack.gif)

### é€’å½’å’Œæ ˆæº¢å‡º

åœ¨äº†è§£äº†è°ƒç”¨æ ˆçš„è¿è¡Œæœºåˆ¶åï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå¯ä»¥è¢«æ— é™å‹æ ˆå—ï¼Ÿå¾ˆæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œæ‰§è¡Œæ ˆæœ¬èº«ä¹Ÿæ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œå½“æ‰§è¡Œæ ˆå†…éƒ¨çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡ç§¯å‹åˆ°ä¸€å®šç¨‹åº¦å¦‚æœç»§ç»­ç§¯å‹ï¼Œå°±ä¼šæŠ¥ â€œæ ˆæº¢å‡ºï¼ˆ`stack overflow`ï¼‰â€ çš„é”™è¯¯ã€‚æ ˆæº¢å‡ºé”™è¯¯ç»å¸¸ä¼šå‘ç”Ÿåœ¨ **é€’å½’** ä¸­ã€‚

![&#x6808;&#x6EA2;&#x51FA;&#x9519;&#x8BEF;](../.gitbook/assets/stackoverflowerror.jpg)

{% hint style="info" %}
ç¨‹åºè°ƒç”¨è‡ªèº«çš„ç¼–ç¨‹æŠ€å·§ç§°ä¸º**é€’å½’ï¼ˆ `recursion`ï¼‰**ã€‚
{% endhint %}

é€’å½’çš„ä½¿ç”¨åœºæ™¯ï¼Œé€šå¸¸æ˜¯åœ¨è¿è¡Œæ¬¡æ•°æœªçŸ¥çš„æƒ…å†µä¸‹ï¼Œç¨‹åºä¼šè®¾å®šä¸€ä¸ªé™å®šæ¡ä»¶ï¼Œé™¤éè¾¾åˆ°è¯¥é™å®šæ¡ä»¶å¦åˆ™ç¨‹åºå°†ä¸€ç›´è°ƒç”¨è‡ªèº«è¿è¡Œä¸‹å»ã€‚é€’å½’çš„é€‚ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚ç´¯åŠ å‡½æ•°ï¼š

```javascript
// æ±‚ 1~num çš„ç´¯åŠ ï¼Œæ­¤æ—¶ num ç”±å¤–éƒ¨ä¼ å…¥ï¼Œæ˜¯æœªçŸ¥çš„
function recursion (num) {
    if (num === 0) return num;
    return recursion(num - 1) + num;
}

recursion(100) // => 5050
recursion(1000) // => 500500
recursion(10000) // => 50005000
recursion(100000) // => Uncaught RangeError: Maximum call stack size exceeded
```

ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªé€’å½’çš„ç´¯åŠ å‡½æ•°ï¼Œåœ¨è®¡ç®— 1 ~ 100000 çš„ç´¯åŠ å’Œçš„æ—¶å€™ï¼Œæ‰§è¡Œæ ˆå°±å´©ä¸ä½äº†ï¼Œè§¦å‘äº†æ ˆæº¢å‡ºçš„é”™è¯¯ã€‚

### å°¾é€’å½’ä¼˜åŒ–

é’ˆå¯¹é€’å½’å­˜åœ¨çš„ â€œçˆ†æ ˆâ€ é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ ä¸€ä¸‹ **å°¾é€’å½’ä¼˜åŒ–**ã€‚â€œé€’å½’â€ æˆ‘ä»¬å·²ç»äº†è§£äº†ï¼Œé‚£ä¹ˆ â€œå°¾â€ æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿâ€œå°¾â€ çš„æ„æ€æ˜¯ â€œå°¾è°ƒç”¨ï¼ˆ`Tail Call`ï¼‰â€ï¼Œå³**å‡½æ•°çš„æœ€åä¸€æ­¥æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°çš„è¿è¡Œç»“æœï¼š**

```javascript
// å°¾è°ƒç”¨æ­£ç¡®ç¤ºèŒƒ1
function a(x){
  return b(x);
}

// å°¾è°ƒç”¨æ­£ç¡®ç¤ºèŒƒ2
// å°¾è°ƒç”¨ä¸ä¸€å®šè¦å†™åœ¨å‡½æ•°çš„æœ€åä¸ºæ­¢ï¼Œåªè¦ä¿è¯æ‰§è¡Œæ—¶æ˜¯æœ€åä¸€éƒ¨æ“ä½œå°±è¡Œäº†ã€‚
function c(x) {
  if (x > 0) {
    return d(x);
  }
  return e(x);
}
```

å°¾è°ƒç”¨ä¹‹æ‰€ä»¥ä¸å…¶ä»–è°ƒç”¨ä¸åŒï¼Œå°±åœ¨äºå®ƒçš„ç‰¹æ®Šçš„è°ƒç”¨ä½ç½®ã€‚å°¾è°ƒç”¨ç”±äºæ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿ç•™å¤–å±‚å‡½æ•°çš„ç›¸å…³ä¿¡æ¯ï¼Œå› ä¸ºè°ƒç”¨ä½ç½®ã€å†…éƒ¨å˜é‡ç­‰ä¿¡æ¯éƒ½ä¸ä¼šå†ç”¨åˆ°äº†ï¼Œåªè¦ç›´æ¥ç”¨å†…å±‚å‡½æ•°çš„è°ƒç”¨è®°å½•ï¼Œå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨è®°å½•å°±å¯ä»¥äº†ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè¿è¡Œå°¾é€’å½’å‡½æ•°æ—¶ï¼Œæ‰§è¡Œæ ˆæ°¸è¿œåªä¼šæ–°å¢ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å°¾è°ƒç”¨çš„æ–¹å¼æ”¹å†™ä¸‹ä¸Šé¢çš„ç´¯åŠ é€’å½’ï¼š

```javascript
// å°¾é€’å½’ä¼˜åŒ–
function recursion (num, sum = 0) {
    if (num === 0) return sum;
    return recursion(num - 1, sum + num);
}

recursion(100000) // => Uncaught RangeError: Maximum call stack size exceeded
```

![](../.gitbook/assets/duang.jpg)

è¿è¡Œä¹‹åæ€ä¹ˆè¿˜æ˜¯æŠ¥é”™äº† ğŸ˜³ ï¼Ÿï¼Ÿè£‚å¼€äº†å‘€ã€‚ã€‚ã€‚  

å…¶å®ï¼Œå°¾é€’å½’ä¼˜åŒ–è¿™ç§ä¸œè¥¿ï¼Œç°åœ¨æ²¡æœ‰ä»»ä½•ä¸€ä¸ªæµè§ˆå™¨æ˜¯æ”¯æŒçš„ï¼Œ`babel` ç¼–è¯‘ä¹Ÿä¸æ”¯æŒã€‚é‚£ `nodejs` é‡Œçš„ `V8` å¼•æ“å‘¢ï¼Ÿå®ƒåšå¥½äº†ï¼Œä½†æ˜¯ä¸ç»™ä½ ç”¨ï¼Œå®˜æ–¹å›ç­”å¦‚ä¸‹ï¼š

> Proper tail calls have been implemented but not yet shipped given that a change to the feature is currently under discussion at TC39.

ç†ç”±å‘¢ï¼Œå®ƒä¹Ÿå¾ˆæœ‰é“ç†ï¼š

* æœ‰å¯èƒ½ç”±äºå¼€å‘è€…æ°´å¹³åŸå› ï¼Œè‡ªå·±å†™çš„å°¾é€’å½’æ˜¯æ­»å¾ªç¯ï¼Œç„¶åå¼•æ“å±‚é¢å®ƒä¼˜åŒ–æ‰äº†ï¼Œåˆä¸æŠ¥é”™ï¼Œå°±è£‚å¼€ã€‚
* å †æ ˆä¿¡æ¯ä¼šåœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œå¼€å‘è€…è°ƒè¯•éå¸¸å›°éš¾ï¼Œå°±å¾ˆçƒ¦ã€‚

æ€»ä¹‹ï¼Œå°¾é€’å½’ä¼˜åŒ–è¿™ä¸ªä¸œè¥¿æš‚æ—¶è¿˜æ˜¯ä¸è¦æƒ³ç”¨åˆ°äº†ï¼Œä¸è¿‡å…ˆäº†è§£ä¸ªæ¦‚å¿µä¹Ÿæ˜¯å¥½çš„ã€‚

### å°è¯•ç‰›åˆ€

åœ¨ç½‘ä¸Šæ‰¾äº†å‡ æ¡æ‰§è¡Œä¸Šä¸‹æ–‡æ¯”è¾ƒå…¸å‹çš„é¢è¯•é¢˜ï¼Œå¤§å®¶å¯ä»¥è¯•ä¸€è¯•ï¼š

**ç¬¬ä¸€é¢˜ï¼š**

```javascript
var foo = function () {
    console.log('foo1');
}

foo();  // foo1

var foo = function () {
    console.log('foo2');
}

foo(); // foo2
```

ç¬¬ä¸€é¢˜æ²¡ä»€ä¹ˆï¼Œåº”è¯¥èƒ½å†™å‡ºæ¥ã€‚

**ç¬¬äºŒé¢˜ï¼š**

```javascript
foo();  // foo2

var foo = function foo() {
    console.log('foo1');
}

function foo() {
    console.log('foo2');
}

foo(); // foo1
```

å…¨å±€æ‰§è¡Œç¯å¢ƒè‡ªåŠ¨åˆ›å»ºï¼Œè¿‡ç¨‹ä¸­ç”Ÿæˆäº†å˜é‡å¯¹è±¡è¿›è¡Œå‡½æ•°å˜é‡çš„å±æ€§æ”¶é›†ï¼Œé€ æˆäº†å‡½æ•°å£°æ˜æå‡ã€å˜é‡å£°æ˜æå‡ã€‚ç”±äºå‡½æ•°å£°æ˜æå‡æ›´åŠ é å‰ï¼Œä¸”å¦‚æœ `var` å®šä¹‰å˜é‡çš„æ—¶å€™å‘ç°å·²æœ‰åŒåå‡½æ•°å®šä¹‰åˆ™è·³è¿‡å˜é‡å®šä¹‰ï¼Œä¸Šé¢çš„ä»£ç å…¶å®å¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ï¼š

```javascript
function foo () {
    console.log('foo2');
}

foo();  // foo2

foo = function foo() {
    console.log('foo1');
};

foo();  // foo1
```

**ç¬¬ä¸‰é¢˜ï¼š**

```javascript
var foo = 1;
function bar () {
    console.log(foo); // undefined
    var foo = 10;
    console.log(foo); // 10
}

bar();
```

`bar` å‡½æ•°è¿è¡Œï¼Œå†…éƒ¨å˜é‡ç”³æ˜æå‡ï¼Œå½“æ‰§è¡Œä»£ç å—ä¸­æœ‰è®¿é—®å˜é‡æ—¶ï¼Œ**å…ˆæŸ¥æ‰¾æœ¬åœ°ä½œç”¨åŸŸ**ï¼Œæ‰¾åˆ°äº† `foo` ä¸º `undefined` ï¼Œæ‰“å°å‡ºæ¥ã€‚ç„¶å `foo` è¢«èµ‹å€¼ä¸º `10` ï¼Œæ‰“å°å‡º `10`ã€‚

**ç¬¬å››é¢˜ï¼š**

```javascript
var foo = 1;
function bar () {
    console.log(foo);
    foo = 2;
}
bar();  // => 1
console.log(foo); // => 2
```

è¿™é¢˜ä¹Ÿæ˜¯è€ƒå¯Ÿçš„ä½œç”¨åŸŸé“¾æŸ¥æ‰¾ï¼Œ`bar` é‡Œæ“ä½œçš„ `foo` å…¶å®æ˜¯ä¸Šå±‚ä½œç”¨åŸŸçš„å˜é‡ã€‚

**ç¬¬äº”é¢˜ï¼š**

```javascript
var foo = 1;
function bar (foo) {
    console.log(foo);
    foo = 234;
}
bar(123);  // => 123
console.log(foo); // => 1
```

### ç›¸å…³å‚è€ƒ

* [JavaScript æ·±å…¥ä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡](https://github.com/mqyqingfeng/Blog/issues/4)
* [JavaScriptæ·±å…¥ä¹‹å˜é‡å¯¹è±¡](https://github.com/mqyqingfeng/Blog/issues/5)
* \*\*\*\*[å›¾è§£Javascriptâ€”â€”å˜é‡å¯¹è±¡å’Œæ´»åŠ¨å¯¹è±¡](https://www.cnblogs.com/ivehd/p/vo_ao.html)
* [\[è¯‘\] ç†è§£ JavaScript ä¸­çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆ](https://juejin.im/post/5ba32171f265da0ab719a6d7#heading-1)
* [ç†è§£Javascriptä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡\(Execution Context**\)**](https://www.cnblogs.com/MinLee/p/5862271.html)\*\*\*\*
* [çŸ¥ä¹ï¼šJSä¸­çš„ä½œç”¨åŸŸé“¾æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å»ºç«‹çš„ï¼Ÿ](https://www.zhihu.com/question/36751764)
* [VOã€AOã€æ‰§è¡Œç¯å¢ƒå’Œä½œç”¨åŸŸé“¾](https://www.cnblogs.com/lulin1/p/9712311.html)
* [å°¾è°ƒç”¨ä¼˜åŒ–](http://www.ruanyifeng.com/blog/2015/04/tail-call.html)
* [JavaScriptè°ƒç”¨æ ˆã€å°¾é€’å½’å’Œæ‰‹åŠ¨ä¼˜åŒ–](https://www.jianshu.com/p/3182429e26b5)

